<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chat Coletivo</title>
<link rel="stylesheet" href="style.css" />
<style>
.chat-box{height:calc(100vh-220px); overflow:auto; border:1px solid #ccc; padding:12px;}
.message{margin-bottom:8px; padding:8px; border-radius:8px; max-width:80%; word-wrap:break-word;}
.message.me{background:#DCF8C6; margin-left:auto;}
.message.other{background:#fff; margin-right:auto; border:1px solid #eee;}
.message img{max-width:120px; display:block; margin-top:4px;}
</style>
</head>
<body>
<div class="container center">
<h2>Chat Coletivo</h2>
<div class="chat-box" id="chatBox"></div>
<input id="msgInput" placeholder="Digite uma mensagem" />
<input type="file" id="fileInput" />
<button id="sendBtn" class="btn green">Enviar</button>

<button id="logoutBtn" class="btn red">Sair</button>
</div>

<script type="module">
import { authActions, chatActions } from './app.js';
authActions.requireTeamVerifiedRedirect();

const chatBox=document.getElementById('chatBox');
const msgInput=document.getElementById('msgInput');
const fileInput=document.getElementById('fileInput');

document.getElementById('sendBtn').onclick=async ()=>{
  const text=msgInput.value.trim();
  if(text){ await chatActions.sendText(text); msgInput.value=''; }
  const file=fileInput.files[0];
  if(file){ await chatActions.sendFile(file); fileInput.value=''; }
};

document.getElementById('logoutBtn').onclick=()=>authActions.logout();

chatActions.onMessages(msgs=>{
  chatBox.innerHTML='';
  msgs.forEach(m=>{
    const div=document.createElement('div');
    div.className='message '+(m.isMe?'me':'other');
    div.innerHTML=`<b>${m.displayName}</b>: ${m.text||''}`;
    if(m.file) div.innerHTML+=`<br><a href="${m.file}" target="_blank">[Arquivo] ${m.fileName||'Arquivo'}</a>`;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop=chatBox.scrollHeight;
});
</script>
</body>
</html>
